<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boletim N° 1 - Monitoramento SAPS</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
</head>
<body>
    <div class="page">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <img src="images/logo.png" alt="Saúde Brasil 360°" class="logo">
                <div class="header-divider"></div>
                <div class="header-text">
                    <h1>
                        <span class="line1">Ministério da Saúde</span><br>
                        <span class="line2">Secretaria de Atenção</span><br>
                        <span class="line3">Primária à Saúde</span>
                    </h1>
                </div>
            </div>
            <div class="boletim-badge">
                <div class="boletim-label">Boletim</div>
                <div class="boletim-number">N° 1</div>
                <div class="boletim-date" id="mes-ano">ago/25</div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="content">
            <p class="intro-text">
                Publicação mensal que acompanha os principais indicadores dos componentes de cofinanciamento federal do Piso de 
                Atenção Primária à Saúde no âmbito do Sistema Único de Saúde (SUS), instituídos pela Portaria GM/MS n° 3.493, de 10 de 
                abril de 2024. Todos os dados são referentes ao mês de julho/25
            </p>

            <!-- Seção CVAT -->
            <h2 class="section-title">Componente de Vínculo e Acompanhamento - CVAT</h2>
            <h3 class="subtitle">Visão geral dos cadastros</h3>

            <!-- Sankey Diagram -->
            <div class="sankey-container">
                <div id="sankeyChart"></div>
            </div>

            <!-- Tabela de Equipes -->
            <div class="equipes-section">
                <h3 class="equipes-title">Equipes - optas a pagamento</h3>
                <table class="equipes-table">
                    <thead>
                        <tr>
                            <td></td>
                            <td colspan="2">ESF</td>
                            <td colspan="2">EAP</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="label-col">Total de equipes</td>
                            <td class="value-col">54.444</td>
                            <td class="change-col positive">+0.46%</td>
                            <td class="value-col">5.596</td>
                            <td class="change-col negative">-0.71%</td>
                        </tr>
                        <tr>
                            <td class="label-col">Equipes abaixo do mínimo (bom)</td>
                            <td class="value-col">22.323</td>
                            <td class="change-col positive">+0.62%</td>
                            <td class="value-col">4.803</td>
                            <td class="change-col negative">-1.7%</td>
                        </tr>
                        <tr>
                            <td class="label-col">Equipes acima do limite cadastral</td>
                            <td class="value-col">2.181</td>
                            <td class="change-col negative">-0.03%</td>
                            <td class="value-col">605</td>
                            <td class="change-col negative">-1.00%</td>
                        </tr>
                        <tr>
                            <td class="label-col">Equipes sem população cadastrada</td>
                            <td class="value-col">123</td>
                            <td class="change-col negative">-0.07%</td>
                            <td class="value-col">1.027</td>
                            <td class="change-col negative">-0.07%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Gráfico de Classificação por Região -->
            <div class="chart-card">
                <div class="regiao-section">
                    <h3 class="regiao-title">Classificação das equipes por Grande Região</h3>
                    <div class="chart-container">
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rodapé colorido -->
        <div class="footer-bar"></div>
    </div>

    <script>
        // Atualizar mês/ano automaticamente
        const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
        const hoje = new Date();
        document.getElementById('mes-ano').textContent = 
            `${meses[hoje.getMonth()]}/${hoje.getFullYear().toString().substr(-2)}`;

        // Criar Sankey Diagram com Plotly
                                                                                                                                                                const sankeyData = {
            type: "sankey",
            orientation: "h",
            node: {
                pad: 15,
                thickness: 30,
                line: {
                    color: "white",
                    width: 2
                },
                label: [
                    "Cad. Rápidos<br>8.868<br>(37.0%)",
                    "Cad. Individuais<br>149.309.039<br>(80.0%)",
                    "Cad. Potenciais<br>61.026.119<br>(32.7%)",
                    "Cad. Vinculados<br>88.282.920<br>(47.3%)",
                    "Ambos<br>2.023.524<br>(1.1%)",
                    "Idoso/Criança<br>10.559.177<br>(5.7%)",
                    "Beneficiários<br>10.737.324<br>(5.8%)",
                    "Sem Critério<br>37.666.094<br>(20.2%)",
                    "Ambos<br>5.446.509<br>(2.9%)",
                    "Idoso/Criança<br>19.018.053<br>(10.2%)",
                    "Beneficiários<br>24.655.211<br>(13.2%)",
                    "Sem Critério<br>39.163.147<br>(21.0%)"
                ],
                color: [
                    "#D2691E", "#183eff", "#D2691E", "#183eff", "#6AB04C", "#5B9BD5", "#183eff", "#999999", "#6AB04C", "#5B9BD5", "#183eff", "#999999"
                ],
                customdata: [
                    "-1.1%", "+0.8%", "-1.3%", "+2.2%", "-3.0%", "-0.8%", "-2.4%", "-1.0%", "+0.9%", "+2.7%", "+2.0%", "+2.1%"
                ],
                hovertemplate: '%{label}<br>Variação: %{customdata}<extra></extra>'
            },
            link: {
                source: [0, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3],
                target: [2, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
                value: [
                    37388868,
                    61026119,
                    88282920,
                    2023524,
                    10559177,
                    10737324,
                    37666094,
                    5446509,
                    19018053,
                    24655211,
                    39163147
                ],
                color: [
                    "rgba(255, 255, 255, 1)",
                    "rgba(24, 62, 255, 0.4)",
                    "rgba(24, 62, 255, 0.4)",
                    "rgba(106, 176, 76, 0.5)",
                    "rgba(91, 155, 213, 0.5)",
                    "rgba(24, 62, 255, 0.5)",
                    "rgba(153, 153, 153, 0.5)",
                    "rgba(106, 176, 76, 0.5)",
                    "rgba(91, 155, 213, 0.5)",
                    "rgba(24, 62, 255, 0.5)",
                    "rgba(153, 153, 153, 0.5)"
                ]
            }
        };
        
        const sankeyLayout = {
            font: {
                size: 11,
                family: 'Arial'
            },
            margin: {
                l: 20,
                r: 20,
                t: 20,
                b: 20
            },
            paper_bgcolor: 'white',
            plot_bgcolor: 'white'
        };

        const sankeyConfig = {
            responsive: true,
            displayModeBar: false
        };

        Plotly.newPlot('sankeyChart', [sankeyData], sankeyLayout, sankeyConfig);

        // Criar gráfico de barras agrupadas
        const ctxChart = document.getElementById('regionChart');
        
        if (ctxChart) {
            new Chart(ctxChart, {
                type: 'bar',
                data: {
                    labels: ['Centro-Oeste', 'Nordeste', 'Norte', 'Sudeste', 'Sul'],
                    datasets: [
                        {
                            label: 'Ótimo',
                            data: [2516, 8970, 1868, 6304, 3362],
                            backgroundColor: 'rgba(24, 62, 255, 0.85)',
                            hoverBackgroundColor: 'rgba(24, 62, 255, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        },
                        {
                            label: 'Bom',
                            data: [1535, 7765, 1491, 8180, 2435],
                            backgroundColor: 'rgba(106, 176, 76, 0.85)',
                            hoverBackgroundColor: 'rgba(106, 176, 76, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        },
                        {
                            label: 'Suficiente',
                            data: [1521, 7521, 1848, 7677, 2735],
                            backgroundColor: 'rgba(255, 193, 7, 0.85)',
                            hoverBackgroundColor: 'rgba(255, 193, 7, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        },
                        {
                            label: 'Regular',
                            data: [7200, 7200, 2467, 19865, 4347],
                            backgroundColor: 'rgba(220, 53, 69, 0.75)',
                            hoverBackgroundColor: 'rgba(220, 53, 69, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 15,
                                boxHeight: 15,
                                padding: 20,
                                font: {
                                    size: 13,
                                    family: 'Arial',
                                    weight: '500'
                                },
                                color: '#333',
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.85)',
                            padding: 14,
                            titleFont: {
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                size: 13
                            },
                            cornerRadius: 6,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return ' ' + context.dataset.label + ': ' + context.parsed.y.toLocaleString('pt-BR') + ' equipes';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600',
                                    family: 'Arial'
                                },
                                color: '#0047AB',
                                padding: 8
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.06)',
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 11,
                                    family: 'Arial'
                                },
                                color: '#666',
                                padding: 8,
                                callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    layout: {
                        padding: {
                            top: 10,
                            right: 10,
                            bottom: 5,
                            left: 5
                        }
                    }
                }
            });
        }

        // Redimensionar canvas ao mudar tamanho da janela
        window.addEventListener('resize', function() {
            canvas.width = container.clientWidth;
            // Redesenhar tudo (opcional)
        });
    </script>
</body>
</html>
