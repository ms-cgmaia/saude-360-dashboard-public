<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boletim N° 10 - Monitoramento SAPS</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
                                                                                                                                                                            <script>
        // Atualizar data e número do boletim automaticamente
        document.addEventListener('DOMContentLoaded', function() {
            const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
            const agora = new Date();
            const mesIndex = agora.getMonth();
            const mesAtual = meses[mesIndex];
            const anoAtual = String(agora.getFullYear()).slice(-2);
            const dataFormatada = `${mesAtual}/${anoAtual}`;

            const elementoData = document.getElementById('mes-ano');
            if (elementoData) {
                elementoData.textContent = dataFormatada;
            }

            const numeroBoletim = mesIndex + 1;
            const elementoNumero = document.querySelector('.boletim-number');
            if (elementoNumero) {
                elementoNumero.textContent = `N° ${numeroBoletim}`;
            }

            const titulo = document.querySelector('title');
            if (titulo) {
                titulo.textContent = `Boletim N° ${numeroBoletim} - Monitoramento SAPS`;
            }
        });
    </script>
</head>
<body>
    <div class="page">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <img src="images/logo.png" alt="Saúde Brasil 360°" class="logo">
                <div class="header-divider"></div>
                <div class="header-text">
                    <h1>
                        <span class="line1">Ministério da Saúde</span><br>
                        <span class="line2">Secretaria de Atenção</span><br>
                        <span class="line3">Primária à Saúde</span>
                    </h1>
                </div>
            </div>
            <div class="boletim-badge">
                <div class="boletim-label">Boletim</div>
                <div class="boletim-number">N° 10</div>
                <div class="boletim-date" id="mes-ano">out/25</div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="content">
            <p class="intro-text">
                Publicação mensal que acompanha os principais indicadores dos componentes de cofinanciamento federal do Piso de 
                Atenção Primária à Saúde no âmbito do Sistema Único de Saúde (SUS), instituídos pela Portaria GM/MS n° 3.493, de 10 de 
                abril de 2024. Todos os dados são referentes ao mês de julho/25
            </p>

            <!-- Seção CVAT -->
            <!-- Sankey Diagram -->
            <div class="sankey-container">
                <h2 class="section-title">Componente de Vínculo e Acompanhamento - CVAT</h2>
                <h3 class="subtitle">Visão geral dos cadastros</h3>
                <div id="sankeyChart"></div>
            </div>

            <!-- Tabela de Equipes -->
            <div class="equipes-section">
                <h3 class="equipes-title">Equipes - optas a pagamento</h3>
                <table class="equipes-table">
                    <thead>
                        <tr>
                            <td></td>
                            <td colspan="2">ESF</td>
                            <td colspan="2">EAP</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="label-col">Total de equipes</td>
                            <td class="value-col">54.444</td>
                            <td class="change-col positive">+0.46%</td>
                            <td class="value-col">5.596</td>
                            <td class="change-col negative">-0.71%</td>
                        </tr>
                        <tr>
                            <td class="label-col">Equipes abaixo do mínimo (bom)</td>
                            <td class="value-col">22.323</td>
                            <td class="change-col positive">+0.62%</td>
                            <td class="value-col">4.803</td>
                            <td class="change-col negative">-1.7%</td>
                        </tr>
                        <tr>
                            <td class="label-col">Equipes acima do limite cadastral</td>
                            <td class="value-col">2.181</td>
                            <td class="change-col negative">-0.03%</td>
                            <td class="value-col">605</td>
                            <td class="change-col negative">-1.00%</td>
                        </tr>
                        <tr>
                            <td class="label-col">Equipes sem população cadastrada</td>
                            <td class="value-col">123</td>
                            <td class="change-col negative">-0.07%</td>
                            <td class="value-col">1.027</td>
                            <td class="change-col negative">-0.07%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Gráfico de Classificação por Região -->
            <div class="chart-card">
                <div class="regiao-section">
                    <h3 class="regiao-title">Classificação das equipes por Grande Região</h3>
                    <div class="chart-container">
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tabela de Municípios Ausentes no CVAT -->
            <div class="equipes-section">
                <h3 class="equipes-title" style="color: #d32f2f;">Municípios ausentes no CVAT</h3>
                    <table class="municipios-table">
                        <thead>
                            <tr>
                                <td class="uf-col">UF</td>
                                <td class="codigo-col">Cód. IBGE</td>
                                <td class="municipio-col">Município</td>
                                <td class="motivo-col">Motivo</td>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="uf-col">MG</td>
                            <td class="codigo-col">314315</td>
                            <td class="municipio-col">MONTE FORMOSO</td>
                            <td class="motivo-col">Possui apenas duas eSFs suspensas por não envio de produção</td>
                        </tr>
                        <tr>
                            <td class="uf-col">MG</td>
                            <td class="codigo-col">316650</td>
                            <td class="municipio-col">SERRA AZUL DE MINAS</td>
                            <td class="motivo-col">Duas eSFs com composição inválida.</td>
                        </tr>
                        <tr>
                            <td class="uf-col">MT</td>
                            <td class="codigo-col">510850</td>
                            <td class="municipio-col">VERA</td>
                            <td class="motivo-col">Possui apenas três eSFs suspensas por não envio de produção</td>
                        </tr>
                        <tr>
                            <td class="uf-col">PA</td>
                            <td class="codigo-col">150570</td>
                            <td class="municipio-col">PONTA DE PEDRAS</td>
                            <td class="motivo-col">Possui apenas oito eSFRs homologadas.</td>
                        </tr>
                        <tr>
                            <td class="uf-col">TO</td>
                            <td class="codigo-col">171370</td>
                            <td class="municipio-col">MONTE SANTO DO TOCANTINS</td>
                            <td class="motivo-col">Possui apenas uma eSF suspenso por órgão de controle</td>
                        </tr>
                        </tbody>
                    </table>
            </div>

            <!-- Visão Geral dos Indicadores de Qualidade -->
            <div class="indicadores-section">
                <h2 class="indicadores-main-title">▶ Visão Geral dos Indicadores de Qualidade</h2>
                
                <div class="indicadores-header">
                    <span class="indicadores-subtitle">▶ Distribuição das equipes - Classificação (%)</span>
                </div>
                
                <div class="indicadores-charts-wrapper">
                    <div class="indicadores-barras">
                        <canvas id="indicadoresChart"></canvas>
                    </div>
                    
                    <div class="indicadores-heatmap">
                        <div class="heatmap-header">
                            <span class="heatmap-title">▶ Desempenho Regional</span>
                        </div>
                        <div class="heatmap-body">
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        26.6
                                        <div class="heatmap-tooltip">1. Mais Acesso à APS<br>Centro-Oeste: 26.6%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        32.5
                                        <div class="heatmap-tooltip">1. Mais Acesso à APS<br>Nordeste: 32.5%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        40.6
                                        <div class="heatmap-tooltip">1. Mais Acesso à APS<br>Norte: 40.6%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        36.6
                                        <div class="heatmap-tooltip">1. Mais Acesso à APS<br>Sudeste: 36.6%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        27.9
                                        <div class="heatmap-tooltip">1. Mais Acesso à APS<br>Sul: 27.9%</div>
                                    </div>
                            </div>
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        20.8
                                        <div class="heatmap-tooltip">2. Desenvolvimento Infantil<br>Centro-Oeste: 20.8%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        21.7
                                        <div class="heatmap-tooltip">2. Desenvolvimento Infantil<br>Nordeste: 21.7%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #e3f2fd">
                                        18.5
                                        <div class="heatmap-tooltip">2. Desenvolvimento Infantil<br>Norte: 18.5%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        23.2
                                        <div class="heatmap-tooltip">2. Desenvolvimento Infantil<br>Sudeste: 23.2%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        23.3
                                        <div class="heatmap-tooltip">2. Desenvolvimento Infantil<br>Sul: 23.3%</div>
                                    </div>
                            </div>
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        38.3
                                        <div class="heatmap-tooltip">3. Cuidado com a Gestante e Puérpera<br>Centro-Oeste: 38.3%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        39.1
                                        <div class="heatmap-tooltip">3. Cuidado com a Gestante e Puérpera<br>Nordeste: 39.1%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        38.0
                                        <div class="heatmap-tooltip">3. Cuidado com a Gestante e Puérpera<br>Norte: 38.0%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        37.9
                                        <div class="heatmap-tooltip">3. Cuidado com a Gestante e Puérpera<br>Sudeste: 37.9%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        41.1
                                        <div class="heatmap-tooltip">3. Cuidado com a Gestante e Puérpera<br>Sul: 41.1%</div>
                                    </div>
                            </div>
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        57.0
                                        <div class="heatmap-tooltip">4. Cuidado da pessoa com Diabetes<br>Centro-Oeste: 57.0%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        60.4
                                        <div class="heatmap-tooltip">4. Cuidado da pessoa com Diabetes<br>Nordeste: 60.4%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        61.9
                                        <div class="heatmap-tooltip">4. Cuidado da pessoa com Diabetes<br>Norte: 61.9%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        56.4
                                        <div class="heatmap-tooltip">4. Cuidado da pessoa com Diabetes<br>Sudeste: 56.4%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        57.5
                                        <div class="heatmap-tooltip">4. Cuidado da pessoa com Diabetes<br>Sul: 57.5%</div>
                                    </div>
                            </div>
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        65.6
                                        <div class="heatmap-tooltip">5. Cuidado da pessoa com Hipertensão<br>Centro-Oeste: 65.6%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        66.8
                                        <div class="heatmap-tooltip">5. Cuidado da pessoa com Hipertensão<br>Nordeste: 66.8%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        70.3
                                        <div class="heatmap-tooltip">5. Cuidado da pessoa com Hipertensão<br>Norte: 70.3%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        62.9
                                        <div class="heatmap-tooltip">5. Cuidado da pessoa com Hipertensão<br>Sudeste: 62.9%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #1976d2">
                                        65.1
                                        <div class="heatmap-tooltip">5. Cuidado da pessoa com Hipertensão<br>Sul: 65.1%</div>
                                    </div>
                            </div>
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        52.9
                                        <div class="heatmap-tooltip">6. Cuidado integral da Pessoa Idosa<br>Centro-Oeste: 52.9%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        52.7
                                        <div class="heatmap-tooltip">6. Cuidado integral da Pessoa Idosa<br>Nordeste: 52.7%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        47.3
                                        <div class="heatmap-tooltip">6. Cuidado integral da Pessoa Idosa<br>Norte: 47.3%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        49.9
                                        <div class="heatmap-tooltip">6. Cuidado integral da Pessoa Idosa<br>Sudeste: 49.9%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #42a5f5">
                                        52.2
                                        <div class="heatmap-tooltip">6. Cuidado integral da Pessoa Idosa<br>Sul: 52.2%</div>
                                    </div>
                            </div>
                            <div class="heatmap-row">
                                <div class="heatmap-arrow">▶</div>
                                                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        27.8
                                        <div class="heatmap-tooltip">7. Prevenção do Câncer na mulher<br>Centro-Oeste: 27.8%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        29.0
                                        <div class="heatmap-tooltip">7. Prevenção do Câncer na mulher<br>Nordeste: 29.0%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        27.8
                                        <div class="heatmap-tooltip">7. Prevenção do Câncer na mulher<br>Norte: 27.8%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        27.8
                                        <div class="heatmap-tooltip">7. Prevenção do Câncer na mulher<br>Sudeste: 27.8%</div>
                                    </div>
                                <div class="heatmap-cell" style="background-color: #90caf9">
                                        29.7
                                        <div class="heatmap-tooltip">7. Prevenção do Câncer na mulher<br>Sul: 29.7%</div>
                                    </div>
                            </div>
                        </div>
                        <div class="heatmap-labels">
                            <div class="label-cell">CENTRO-OESTE</div>
                            <div class="label-cell">NORDESTE</div>
                            <div class="label-cell">NORTE</div>
                            <div class="label-cell">SUDESTE</div>
                            <div class="label-cell">SUL</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Municípios com Pontuação Zerada -->
            <div class="chart-card">
                <h2 class="section-title">Municípios que apresentaram pontuação zerada em todos os indicadores de qualidade, simultaneamente, no mês de referência</h2>
                
                <div class="municipios-zerados-container">
                    <table class="municipios-zerados-table">
                        <thead>
                            <tr>
                                <td class="uf-col">UF</td>
                                <td class="codigo-col">Cód. IBGE</td>
                                <td class="municipio-col">Município</td>
                                <td class="observacao-col">Observação</td>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="uf-col">MG</td>
                            <td class="codigo-col">313730</td>
                            <td class="municipio-col">LAGOA DOS PATOS</td>
                            <td class="observacao-col">Tem apenas uma eAP 20h.</td>
                        </tr>
                        <tr>
                            <td class="uf-col">RS</td>
                            <td class="codigo-col">430225</td>
                            <td class="municipio-col">BOA VISTA DO SUL</td>
                            <td class="observacao-col">Tem apenas duas eSFs.</td>
                        </tr>
                        <tr>
                            <td class="uf-col">SP</td>
                            <td class="codigo-col">350200</td>
                            <td class="municipio-col">ANALÂNDIA</td>
                            <td class="observacao-col">Tem apenas duas eAPs 20h.</td>
                        </tr>
                        </tbody>
                    </table>
                    
                    <div class="observacao-footer">
                        <p><strong>Observação:</strong> as equipes dos municípios listados estão recebendo o componente de qualidade referente à classificação "Bom", conforme § 3°, art. 12 da <u>Portaria GM/MS n° 3.493, de 10 de abril de 2024</u>.</p>
                    </div>
                </div>
            </div>

            <!-- Evolução Municipal -->
            <div class="chart-card">
                <h2 class="section-title">Evolução mensal dos municípios</h2>
                <div class="chart-content">
                    <canvas id="evolucao-municipal-chart" style="height: 420px;"></canvas>
                </div>
            </div>

        <!-- Rodapé colorido -->
        
    </div>
    <div class="footer-bar"></div>

    <script>
        // Atualizar mês/ano automaticamente
        const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
        const hoje = new Date();
        document.getElementById('mes-ano').textContent = 
            `${meses[hoje.getMonth()]}/${hoje.getFullYear().toString().substr(-2)}`;

        // Criar Sankey Diagram com Plotly
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const sankeyData = {
            type: "sankey",
            orientation: "h",
            node: {
                pad: 15,
                thickness: 30,
                line: {
                    color: "white",
                    width: 2
                },
                label: [
                    "Cad. Rápidos<br>37.388.868<br>(20.0%)",
                    "Cad. Individuais<br>149.309.039<br>(80.0%)",
                    "Cad. Potenciais<br>61.026.119<br>(32.7%)",
                    "Cad. Vinculados<br>88.282.920<br>(47.3%)",
                    "Ambos<br>2.023.524<br>(1.1%)",
                    "Idoso/Criança<br>10.559.177<br>(5.7%)",
                    "Beneficiários<br>10.737.324<br>(5.8%)",
                    "Sem Critério<br>37.666.094<br>(20.2%)",
                    "Ambos<br>5.446.509<br>(2.9%)",
                    "Idoso/Criança<br>19.018.053<br>(10.2%)",
                    "Beneficiários<br>24.655.211<br>(13.2%)",
                    "Sem Critério<br>39.163.147<br>(21.0%)"
                ],
                color: [
                    "#D2691E", "#183eff", "#D2691E", "#183eff", "#6AB04C", "#5B9BD5", "#183eff", "#999999", "#6AB04C", "#5B9BD5", "#183eff", "#999999"
                ],
                customdata: [
                    "-1.1%", "+0.8%", "-1.3%", "+2.2%", "-3.0%", "-0.8%", "-2.4%", "-1.0%", "+0.9%", "+2.7%", "+2.0%", "+2.1%"
                ],
                hovertemplate: '%{label}<br>Variação: %{customdata}<extra></extra>'
            },
            link: {
                source: [0, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3],
                target: [0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
                value: [
                    37388868,
                    61026119,
                    88282920,
                    2023524,
                    10559177,
                    10737324,
                    37666094,
                    5446509,
                    19018053,
                    24655211,
                    39163147
                ],
                color: [
                    "rgba(255, 255, 255, 1)",
                    "rgba(24, 62, 255, 0.4)",
                    "rgba(24, 62, 255, 0.4)",
                    "rgba(106, 176, 76, 0.5)",
                    "rgba(91, 155, 213, 0.5)",
                    "rgba(24, 62, 255, 0.5)",
                    "rgba(153, 153, 153, 0.5)",
                    "rgba(106, 176, 76, 0.5)",
                    "rgba(91, 155, 213, 0.5)",
                    "rgba(24, 62, 255, 0.5)",
                    "rgba(153, 153, 153, 0.5)"
                ]
            }
        };
        
        const sankeyLayout = {
            font: {
                size: 11,
                family: 'Arial'
            },
            margin: {
                l: 20,
                r: 20,
                t: 20,
                b: 20
            },
            paper_bgcolor: 'white',
            plot_bgcolor: 'white'
        };

        const sankeyConfig = {
            responsive: true,
            displayModeBar: false
        };

        Plotly.newPlot('sankeyChart', [sankeyData], sankeyLayout, sankeyConfig);

        // Criar gráfico de barras agrupadas
        const ctxChart = document.getElementById('regionChart');
        
        if (ctxChart) {
            new Chart(ctxChart, {
                type: 'bar',
                data: {
                    labels: ['Centro-Oeste', 'Nordeste', 'Norte', 'Sudeste', 'Sul'],
                    datasets: [
                        {
                            label: 'Ótimo',
                            data: [2516, 8970, 1868, 6304, 3362],
                            backgroundColor: 'rgba(24, 62, 255, 0.85)',
                            hoverBackgroundColor: 'rgba(24, 62, 255, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        },
                        {
                            label: 'Bom',
                            data: [1535, 7765, 1491, 8180, 2435],
                            backgroundColor: 'rgba(106, 176, 76, 0.85)',
                            hoverBackgroundColor: 'rgba(106, 176, 76, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        },
                        {
                            label: 'Suficiente',
                            data: [1521, 7521, 1848, 7677, 2735],
                            backgroundColor: 'rgba(255, 193, 7, 0.85)',
                            hoverBackgroundColor: 'rgba(255, 193, 7, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        },
                        {
                            label: 'Regular',
                            data: [7200, 7200, 2467, 19865, 4347],
                            backgroundColor: 'rgba(220, 53, 69, 0.75)',
                            hoverBackgroundColor: 'rgba(220, 53, 69, 1)',
                            borderRadius: 6,
                            barThickness: 40
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 15,
                                boxHeight: 15,
                                padding: 20,
                                font: {
                                    size: 13,
                                    family: 'Arial',
                                    weight: '500'
                                },
                                color: '#333',
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.85)',
                            padding: 14,
                            titleFont: {
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                size: 13
                            },
                            cornerRadius: 6,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return ' ' + context.dataset.label + ': ' + context.parsed.y.toLocaleString('pt-BR') + ' equipes';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600',
                                    family: 'Arial'
                                },
                                color: '#0047AB',
                                padding: 8
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.06)',
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 11,
                                    family: 'Arial'
                                },
                                color: '#666',
                                padding: 8,
                                callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    layout: {
                        padding: {
                            top: 10,
                            right: 10,
                            bottom: 5,
                            left: 5
                        }
                    }
                }
            });
        }

        // Redimensionar canvas ao mudar tamanho da janela
        window.addEventListener('resize', function() {
            canvas.width = container.clientWidth;
            // Redesenhar tudo (opcional)
        });
    </script>

    <!-- JavaScript para Gráfico de Indicadores de Qualidade -->
    <script>
        // Dados do gráfico de barras horizontais
        const indicadoresData = {
            labels: ['1. Mais Acesso à APS', '2. Desenvolvimento Infantil', '3. Cuidado com a Gestante e Puérpera', '4. Cuidado da pessoa com Diabetes', '5. Cuidado da pessoa com Hipertensão', '6. Cuidado integral da Pessoa Idosa', '7. Prevenção do Câncer na mulher'],
            datasets: [
                {
                    label: 'Ótimo',
                    data: [15, 0, 12, 7, 23, 2, 0],
                    backgroundColor: '#2E7D4F',
                    borderWidth: 0
                },
                {
                    label: 'Bom',
                    data: [20, 30, 0, 63, 57, 52, 0],
                    backgroundColor: '#5CB85C',
                    borderWidth: 0
                },
                {
                    label: 'Suficiente',
                    data: [22, 0, 73, 25, 16, 40, 69],
                    backgroundColor: '#F0AD4E',
                    borderWidth: 0
                },
                {
                    label: 'Regular',
                    data: [43, 68, 15, 5, 4, 6, 31],
                    backgroundColor: '#D9534F',
                    borderWidth: 0
                }
            ]
        };

        const indicadoresOptions = {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 15,
                        padding: 15,
                        font: {
                            size: 11
                        }
                    }
                },
                title: {
                    display: false
                }
            },
            scales: {
                x: {
                    stacked: true,
                    beginAtZero: true,
                    max: 100,
                    grid: {
                        color: '#e0e0e0',
                        lineWidth: 1
                    },
                    ticks: {
                        font: {
                            size: 10
                        }
                    }
                },
                y: {
                    stacked: true,
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 11
                        }
                    }
                }
            },
            elements: {
                bar: {
                    borderRadius: 0
                }
            },
            layout: {
                padding: {
                    top: 10,
                    bottom: 10
                }
            },
            datasets: {
                bar: {
                    categoryPercentage: 0.8,
                    barPercentage: 0.6
                }
            }
        };

        // Criar o gráfico de barras horizontais
        const indicadoresCtx = document.getElementById('indicadoresChart').getContext('2d');
        const indicadoresChart = new Chart(indicadoresCtx, {
            type: 'bar',
            data: indicadoresData,
            options: indicadoresOptions
        });

        // Dados do gráfico de evolução municipal
        const evolucaoData = {
            labels: ['JAN/2025', 'FEV/2025', 'MAR/2025', 'ABR/2025', 'MAI/2025', 'JUN/2025', 'JUL/2025'],
            datasets: [
                {
                    label: 'Municípios que não aparecem no CVAT',
                    data: [14, 13, 12, 9, 6, 7, 5],
                    backgroundColor: '#1976d2',
                    borderWidth: 0,
                    borderRadius: 4
                },
                {
                    label: 'Municípios com todos indicadores zerados',
                    data: [0, 1, 1, 1, 5, 3, 3],
                    backgroundColor: '#90caf9',
                    borderWidth: 0,
                    borderRadius: 4
                }
            ]
        };

        const evolucaoOptions = {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: {
                    top: 40,
                    bottom: 0
                }
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 15,
                        padding: 15,
                        font: {
                            size: 11
                        }
                    }
                },
                title: {
                    display: false
                }
            },
            scales: {
                x: {
                    stacked: true,
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 10
                        }
                    }
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 10
                        },
                        stepSize: 1
                    }
                }
            },
            elements: {
                bar: {
                    borderRadius: 4
                }
            }
        };

        const evolucaoLabelsPlugin = {
            id: 'evolucaoLabelsPlugin',
            afterDatasetsDraw(chart) {
                const { ctx } = chart;
                ctx.save();
                chart.data.datasets.forEach((dataset, datasetIndex) => {
                    const meta = chart.getDatasetMeta(datasetIndex);
                    if (!meta || meta.hidden) {
                        return;
                    }
                    meta.data.forEach((element, index) => {
                        const value = dataset.data[index];
                        if (value === null || value === undefined || Number(value) === 0) {
                            return;
                        }
                        const position = element.tooltipPosition();
                        const barHeight = element.base - element.y;
                        const x = element.x ?? position.x;
                        const labelColor = datasetIndex === 0 ? '#ffffff' : '#111827';
                        ctx.fillStyle = labelColor;
                        ctx.font = '600 11px "Inter", system-ui, -apple-system, sans-serif';
                        ctx.textAlign = 'center';

                        if (datasetIndex === 0) {
                            // Segmento inferior: centralizar dentro da barra
                            const y = element.base - barHeight / 2;
                            ctx.textBaseline = 'middle';
                            ctx.fillText(value, x, y);
                        } else {
                            // Segmento superior: exibir acima da barra
                            const offset = Math.min(16, Math.max(4, barHeight * 0.4));
                            ctx.textBaseline = 'bottom';
                            ctx.fillText(value, x, element.y - offset);
                        }
                    });
                });
                ctx.restore();
            }
        };

        // Criar o gráfico de evolução municipal
        const evolucaoCtx = document.getElementById('evolucao-municipal-chart').getContext('2d');
        const evolucaoChart = new Chart(evolucaoCtx, {
            type: 'bar',
            data: evolucaoData,
            options: evolucaoOptions,
            plugins: [evolucaoLabelsPlugin]
        });
</script>

<!-- Botão de impressão flutuante -->
<button id="printButton" class="print-button-float" onclick="imprimirPagina()" title="Imprimir Dashboard (ao imprimir, selecione Margens: Nenhum na caixa de diálogo)">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2M6 14h12v8H6v-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
</button>

<script>
function imprimirPagina() {
    alert('DICA IMPORTANTE:\n\nAo imprimir, selecione a opção "Margens: Nenhum" na caixa de diálogo para melhor resultado!');
    console.log('Botão clicado - iniciando impressão');
    try {
        window.print();
    } catch(e) {
        console.error('Erro ao imprimir:', e);
        alert('Erro ao tentar imprimir. Tente usar Ctrl+P');
    }
}
</script>


<!-- Footer-bar para impressão -->
<div class="footer-bar-print"></div>

</body>
</html>
